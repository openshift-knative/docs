<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orchestrating the OpenAPI services :: Red Hat OpenShift Serverless previews</title>
    <link rel="canonical" href="https://openshift-knative.github.io/docs/docs/main/service-orchestration/orchestration-of-openapi-based-services.html">
    <meta name="description" content="Orchestration of OpenAPI based services">
    <meta name="keywords" content="kogito, workflow, serverless, openapi, services, json">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/extra.css">
<link rel="stylesheet" href="../../../_/css/custom.css">
<link rel="stylesheet" href="../../../_/css/tabs.css">
<link rel="stylesheet" href="../../../_/font-awesome-4.7.0/css/font-awesome.min.css">
<!--
<link rel="icon" href="../../../favicon.ico" type="image/x-icon">
-->
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <button class="navbar-burger" data-target="topbar-nav">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <img src="../../../_/img/serverless-icon.svg" class="navbar-logo" alt="OpenShift Serverless icon">
        <a href="">OpenShift Serverless Previews</a>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- search broken
        <div class="navbar-item hide-for-print">
          <script async src="https://cse.google.com/cse.js?cx=002898025167115630151:gnr5edrg2eo"></script>
          <div class="gcse-searchbox" enableAutoComplete="true"></div>
        </div>
      -->
        <a class="navbar-item" href="https://openshift-knative.github.io/docs/docs/index.html">Home</a>
        <a class="navbar-item" href="https://developers.redhat.com/topics/serverless-architecture">Blog</a>
        <a class="navbar-item" href="https://kogito.kie.org/">The Kogito Project</a>
      </div>
    </div>
  </nav>
<!-- need alt search type-->
<!--<div class="gcse-searchresults"></div>-->
</header>
<div class="main-wrapper">
  <div class="navigation-container" data-component="docs" data-version="main">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../about.html">About</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Workflows</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/create-your-first-workflow-service.html">Creating your first workflow service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/cncf-serverless-workflow-specification-support.html">CNCF Serverless Workflow specification</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/getting-familiar-with-our-tooling.html">Getting familiar with OpenShift Serverless Logic tooling</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Core</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/understanding-jq-expressions.html">jq expressions in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/understanding-workflow-error-handling.html">Error handling in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/working-with-parallelism.html">Parallelism in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/configuration-properties.html">Configuration properties in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/custom-functions-support.html">Custom functions for your OpenShift Serverless Logic service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Tooling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-overview.html">Serverless Workflow editor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-vscode-extension.html">VS Code extension for Serverless Workflow editor</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-chrome-extension.html">Chrome GitHub extension for Serverless Workflow editor</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-overview.html">Kogito Serverless Workflow Tools extension in Quarkus Dev UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-instances-page.html">Workflow Instances in Kogito Serverless Workflow Tools extension</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-definition-page.html">Workflow Definitions in Kogito Serverless Workflow Tools extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/kn-plugin-workflow-overview.html">OpenShift Serverless Logic plug-in for Knative CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Service Orchestration</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="orchestration-of-openapi-based-services.html">Orchestrating the OpenAPI services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="configuring-openapi-services-endpoints.html">Configuring the OpenAPI services endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="orchestration-of-grpc-services.html">Orchestration of gRPC based services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Eventing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/handling-events-on-workflows.html">Event state in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/consume-producing-events-with-kafka.html">Consuming and producing events using Apache Kafka</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/consume-produce-events-with-knative-eventing.html">Consuming and producing events on Knative Eventing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/event-correlation-with-workflows.html">Event correlation in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../eventing/working-with-callbacks.html">Callback state in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security/authention-support-for-openapi-services.html">Authentication for OpenAPI services in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security/orchestrating-third-party-services-with-oauth2.html">Orchestration of third-party services using OAuth 2.0 authentication in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Testing and Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../testing-and-troubleshooting/mocking-http-cloudevents-with-wiremock.html">Mocking HTTP CloudEvents sink using WireMock</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../testing-and-troubleshooting/mocking-openapi-services-with-wiremock.html">Mocking OpenAPI services using WireMock</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../testing-and-troubleshooting/basic-integration-tests-with-restassured.html">Testing your workflow application using REST Assured</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../testing-and-troubleshooting/integration-tests-with-postgresql.html">OpenShift Serverless Logic integration test using PostgreSQL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../persistence/persistence-with-postgresql.html">Running a workflow service using PostgreSQL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Cloud</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cloud/build-workflow-image-with-quarkus-cli.html">Building workflow images using Quarkus CLI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cloud/deploying-on-minikube.html">Deploying your OpenShift Serverless Logic application on Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/serverless-dashboard-with-runtime-data.html">Displaying workflow data in dashboards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Use Cases</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../use-cases/orchestration-based-saga-pattern.html">Saga orchestration example in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Documentation</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Documentation</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <div class="main-view-and-toolbar">
    <div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">Documentation</a></li>
    <li class="crumb">Workflows</li>
    <li class="crumb">Service Orchestration</li>
    <li class="crumb"><a href="orchestration-of-openapi-based-services.html">Orchestrating the OpenAPI services</a></li>
  </ul>
</nav>
</div>
    <div class="main-view-and-toc">
        <main class="main">
          <article class="doc">
<h1>Orchestrating the OpenAPI services</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document describes how to call REST services using an <a href="https://spec.openapis.org/oas/v3.1.0.html">OpenAPI</a> specification file.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A workflow project is created.</p>
<div class="paragraph">
<p>For more information about creating a workflow project, see <a href="../getting-started/create-your-first-workflow-service.html" class="xref page">Creating your first Serverless Workflow service</a>.</p>
</div>
</li>
<li>
<p>You have installed the tooling.</p>
<div class="paragraph">
<p>For more information about the tooling, see <a href="../getting-started/getting-familiar-with-our-tooling.html" class="xref page">Getting familiar with OpenShift Serverless Logic tooling</a>.</p>
</div>
</li>
</ul>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#con-openapi-function-definition">OpenAPI function definition</a></li>
<li><a href="#proc-send-request-rest-call-openapi-spec">Sending REST requests based on the OpenAPI specification</a>
<ul class="sectlevel2">
<li><a href="#proc-define-openapi-functions">Defining OpenAPI functions in a workflow</a></li>
<li><a href="#proc-access-function-sw-states">Accessing functions in the workflow states</a></li>
</ul>
</li>
<li><a href="#proc-configuring-openapi-service-endpoint-url">Configuring the endpoint URL of OpenAPI services</a></li>
<li><a href="#_additional_resources">Additional resources</a></li>
<li><a href="#_found_an_issue"><em><strong>Found an issue?</strong></em></a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="con-openapi-function-definition"><a class="anchor" href="#con-openapi-function-definition"></a>OpenAPI function definition</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift Serverless Logic follows the <a href="https://github.com/serverlessworkflow/specification/blob/0.8.x/specification.md#using-functions-for-restful-service-invocations">CNCF Serverless Workflow specification function definition</a> to send requests to remote REST services using an OpenAPI specification reference as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example of an OpenAPI function definition</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "functions":[
      {
         "name":"myFunction1",
         "operation":"classpath:/myopenapi-file.yaml#myFunction1"
      }
   ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the previous example function definition, the <code>type</code> attribute can be omitted as the <a href="https://github.com/serverlessworkflow/specification/blob/0.8.x/specification.md#Function-Definition">default value</a> is <code>rest</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the previous example, the <code>operation</code> attribute is a string, which is composed using the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>URI that the engine uses to locate the specification file, such as <code>classpath</code>.</p>
</li>
<li>
<p>Operation identifier. You can find the operation identifier in the <a href="https://spec.openapis.org/oas/v3.1.0.html#fixed-fields-7">OpenAPI specification file</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>OpenShift Serverless Logic supports the following URI schemes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>classpath</code>: This URI scheme is supported for the files that are located in the <code>src/main/resources</code> folder of the application project. The <code>classpath</code> is the default URI scheme. If you do not define a URI scheme as shown in the following examples, the file location is defined as <code>src/main/resources/myopenapifile.yaml</code>:</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><code>/myopenapifile.yaml</code></p>
</div>
</div>
</div>
</li>
<li>
<p><code>file</code>: This URI scheme is supported for the files that are located in the file system.</p>
</li>
<li>
<p><code>http</code> or <code>https</code>: This URI scheme is supported for remotely located files.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The OpenAPI specification files must be available during the build time, because OpenShift Serverless Logic leverages the internal code generation feature to send requests on runtime. Therefore, once you have built the application image, OpenShift Serverless Logic will not have access to the files.</p>
</div>
<div class="paragraph">
<p>For more information about building workflow images, see <a href="../cloud/build-workflow-image-with-quarkus-cli.html" class="xref page">Building workflow images using Quarkus CLI</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get started with orchestrating the OpenAPI based services, you must locate the REST services OpenAPI specification files. Usually, REST services expose their interface using the OpenAPI specification. For example, see the <a href="https://petstore3.swagger.io/api/v3/openapi.json">Petstore API</a>.</p>
</div>
<div class="paragraph">
<p>In case, the OpenAPI service that you want to add to the workflow does not contain a specification file, you can either create a specification file or update the OpenAPI service to generate and expose the file.</p>
</div>
<div class="paragraph">
<p>There are various REST frameworks that support the OpenAPI specification generation, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://quarkus.io/guides/openapi-swaggerui">Quarkus - Using OpenAPI and Swagger UI</a></p>
</li>
<li>
<p><a href="https://springdoc.org/#Introduction">Spring Boot Documentation</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Go</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://goswagger.io/">Go Swagger Documentation</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Python</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/flasgger/flasgger">Flasgger</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>.NET</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/web-api-help-pages-using-swagger?view=aspnetcore-6.0">ASP.NET Core web API documentation with Swagger/OpenAPI</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>TypeScript</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.npmjs.com/package/swagger-ui-express">Swagger UI Express</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>PHP</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/zircote/swagger-php">swagger-php</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you do not have access to the REST service, which is used to add the OpenAPI specification generator, you can use Swagger Inspector. The <a href="https://swagger.io/docs/swagger-inspector/how-to-create-an-openapi-definition-using-swagger/">Swagger Inspector</a> generates the specification file based on HTTP traffic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="proc-send-request-rest-call-openapi-spec"><a class="anchor" href="#proc-send-request-rest-call-openapi-spec"></a>Sending REST requests based on the OpenAPI specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To send REST requests that are based on the OpenAPI specification files, you need to perform the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define the function references</p>
</li>
<li>
<p>Access the defined functions in the workflow states</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="proc-define-openapi-functions"><a class="anchor" href="#proc-define-openapi-functions"></a>Defining OpenAPI functions in a workflow</h3>
<div class="paragraph">
<p>To send requests with the REST calls, first you need to define the OpenAPI functions.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have access to the OpenAPI specification files.</p>
<div class="paragraph">
<p>Once you have access to the OpenAPI specification files, you can define the functions in the workflow.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also use the <a href="https://github.com/kiegroup/kogito-examples/tree/main/serverless-workflow-examples/serverless-workflow-temperature-conversion"><code>serverless-workflow-temperature-conversion</code></a> example application as a reference.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the OpenAPI specification files of the service(s) you want to invoke into your workflow service directory, which can be <code>src/main/resources/specs</code>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>In the <code>serverless-workflow-temperature-conversion</code> example application, the services that are invoked include multiplication and subtraction services.</p>
</div>
<div class="paragraph">
<p>The OpenAPI specification files in <code>serverless-workflow-temperature-conversion</code> example application are extracted from the running multiplication and subtraction services. The REST Quarkus applications expose the related OpenAPI specification files using the <a href="https://quarkus.io/guides/openapi-swaggerui">Quarkus Swagger extension</a>.</p>
</div>
<div class="paragraph">
<p>Following is an example OpenAPI specification of the multiplication REST service:</p>
</div>
<div class="listingblock">
<div class="title">Example multiplication REST service OpenAPI specification</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">openapi: 3.0.3
info:
  title: Generated API
  version: "1.0"
paths:
  /:
    post:
     operationId: doOperation <i class="conum" data-value="1"></i><b>(1)</b>
     parameters:
        - in: header
          name: notUsed
          schema:
            type: string
          required: false
     requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MultiplicationOperation'
     responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  product:
                    format: float
                    type: number
components:
  schemas:
    MultiplicationOperation: <i class="conum" data-value="2"></i><b>(2)</b>
      type: object
      properties:
        leftElement:
          format: float
          type: number
        rightElement:
          format: float
          type: number</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>operationId</code> of the REST operation. The <code>operationId</code> in an OpenAPI specification is necessary to add a reference to the operation that you want to use in REST invocation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Data structure of the REST operation.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Use the same <code>operationId</code> to compose the final URI in the function definition as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">OpenAPI functions definition in the Temperature Conversion example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "functions": [
    {
      "name": "multiplication",
      "operation": "specs/multiplication.yaml#doOperation" <i class="conum" data-value="1"></i><b>(1)</b>
    },
    {
      "name": "subtraction",
      "operation": "specs/subtraction.yaml#doOperation" <i class="conum" data-value="2"></i><b>(2)</b>
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Function definition for OpenAPI multiplication function</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Function definition for OpenAPI subtraction function</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that in the previous example, the <code>multiplication</code> and <code>subtraction</code> OpenAPI files are stored in the <code>src/main/resources/specs</code> folder of the application.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-access-function-sw-states"><a class="anchor" href="#proc-access-function-sw-states"></a>Accessing functions in the workflow states</h3>
<div class="paragraph">
<p>After defining the function definitions, you can access the defined functions in the workflow states.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have defined the OpenAPI functions in a workflow. For more information, see <a href="#proc-define-openapi-functions">Defining OpenAPI functions in a workflow</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Use a <a href="https://github.com/serverlessworkflow/specification/blob/0.8.x/specification.md#Action-Definition">workflow action</a> to call a function definition that you added.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Any workflow action that consists of a similar approach of referencing the functions that you used in the function definition can call a defined function.</p>
</div>
</div>
</div>
</li>
<li>
<p>To map the arguments of a function, you can refer to the parameters described in the <a href="https://spec.openapis.org/oas/v3.1.0.html#operation-object">Operation Object</a> section of OpenAPI specification.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Also, the engine maps the parameter naming according to the OpenAPI specification. After that, you can use <a href="../core/understanding-jq-expressions.html" class="xref page">jq expressions</a> to extract the payload data and map the data to the required parameters.</p>
</div>
<div class="paragraph">
<p>In the following example, the parameters are part of the request body:</p>
</div>
<div class="listingblock">
<div class="title">Example of mapping a function arguments</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "states": [
    {
      "name": "SetConstants",
      "type": "inject",
      "data": {
        "subtractValue": 32.0,
        "multiplyValue": 0.5556
      },
      "transition": "Computation"
    },
    {
      "name": "Computation",
      "actionMode": "sequential",
      "type": "operation", <i class="conum" data-value="1"></i><b>(1)</b>
      "actions": [
        {
          "name": "subtract",
          "functionRef": {
            "refName": "subtraction", <i class="conum" data-value="2"></i><b>(2)</b>
            "arguments": { <i class="conum" data-value="3"></i><b>(3)</b>
              "leftElement": ".fahrenheit",
              "rightElement": ".subtractValue"
            }
          }
        },
        {
          "name": "multiply",
          "functionRef": {
            "refName": "multiplication", <i class="conum" data-value="4"></i><b>(4)</b>
            "arguments": { <i class="conum" data-value="5"></i><b>(5)</b>
               "leftElement": ".difference",
               "rightElement": ".multiplyValue"
            }
          }
        }
      ],
      "end": {
        "terminate": "true"
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Operation State definition</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Reference to the <code>subtraction</code> function</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Definition of the <code>subtraction</code> function arguments</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Reference to the <code>multiplication</code> function</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Definition of the <code>multiplication</code> function arguments</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the <code>serverless-workflow-temperature-conversion</code> example application, the functions are called sequentially in an <a href="https://github.com/serverlessworkflow/specification/blob/0.8.x/specification.md#operation-state">Operation State</a> as shown in the previous example.</p>
</div>
<div class="paragraph">
<p>For more information about mapping parameters in the request path instead of request body, you can refer to the following PetStore API example:</p>
</div>
<div class="listingblock">
<div class="title">Example Petstore OpenAPI specification excerpt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "/pet/{petId}": {
      "get": {
        "tags": [
          "pet"
        ],
        "summary": "Find pet by ID",
        "description": "Returns a single pet",
        "operationId": "getPetById",
        "parameters": [
          {
            "name": "petId",
            "in": "path",
            "description": "ID of pet to return",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ]
     }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following is an example invocation of a function, in which only one parameter named <code>petId</code> is added in the request path:</p>
</div>
<div class="listingblock">
<div class="title">Example of calling the PetStore function</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "name": "CallPetStore", <i class="conum" data-value="1"></i><b>(1)</b>
  "actionMode": "sequential",
  "type": "operation",
  "actions": [
    {
      "name": "getPet",
      "functionRef": {
        "refName": "getPetById", <i class="conum" data-value="2"></i><b>(2)</b>
        "arguments": { <i class="conum" data-value="3"></i><b>(3)</b>
          "petId": ".petId"
        }
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>State definition, such as <code>CallPetStore</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Function definition reference. In the previous example, the function definition <code>getPetById</code> is for PetStore OpenAPI specification.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Arguments definition. In the previous example, OpenShift Serverless Logic adds the argument <code>petId</code> to the request path before sending a request.</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="proc-configuring-openapi-service-endpoint-url"><a class="anchor" href="#proc-configuring-openapi-service-endpoint-url"></a>Configuring the endpoint URL of OpenAPI services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After accessing the function definitions in workflow states, you can configure the endpoint URL of OpenAPI services.</p>
</div>
<div class="paragraph">
<p>OpenShift Serverless Logic uses the <a href="https://github.com/quarkiverse/quarkus-openapi-generator">Quarkus OpenAPI Generator extension</a> and the <a href="https://quarkus.io/guides/rest-client">Quarkus REST Client</a>, and all the configurations are based on these components, which are backed using <a href="https://quarkus.io/guides/config">Quarkus Configuration</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have defined the function definitions in the workflow. For more information, see <a href="#proc-define-openapi-functions">Defining OpenAPI functions in a workflow</a>.</p>
</li>
<li>
<p>You have the access to the defined functions in the workflow states. For more information, see <a href="#proc-access-function-sw-states">Accessing functions in the workflow states</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To configure the endpoints, you must use the sanitized OpenAPI specification file name as the <a href="https://quarkus.io/guides/rest-client#create-the-configuration">REST client configuration key</a>. The configuration key must be set as a valid environment variable.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For example, a file named as <code>subtraction.yaml</code> contains the configuration key as <code>subtraction_yaml</code>.</p>
</div>
<div class="paragraph">
<p>For more information about how to sanitize file names, see <a href="https://github.com/eclipse/microprofile-config/blob/master/spec/src/main/asciidoc/configsources.asciidoc#environment-variables-mapping-rules">Environment Variables Mapping Rules</a>.</p>
</div>
</div>
</div>
</li>
<li>
<p>You can use the same configuration key on each property that is related to the Quarkus REST client as shown in the following URL configuration example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example of URL configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.rest-client.subtraction_yaml.url=http://myserver.com</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>To avoid hardcoding the URL in the <code>application.properties</code> file, you can use <a href="https://quarkus.io/guides/config#with-environment-variables">environment variables substitution</a>, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example of URL configuration with environment variables</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.rest-client.subtraction_yaml.url=${SUBTRACTION_URL:http://myserver.com}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case the environment variable <code>SUBTRACTION_URL</code> is not found in the previous example, the URL redirects to <code><a href="http://myserver.com" class="bare">myserver.com</a></code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also use environment variables to configure the application in Kubernetes environments, in which variables can be injected into the pod of the application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information about endpoints and general configuration, see <a href="configuring-openapi-services-endpoints.html" class="xref page">Configuring the OpenAPI services endpoints</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In a future release, OpenShift Serverless Logic will provide support for Kubernetes Service Discovery feature. Using the Kubernetes Service Discovery feature, you can point to a Kubernetes or Knative object that you want to call. After that, the engine will automatically configure the endpoints once you deploy the endpoints in the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources"><a class="anchor" href="#_additional_resources"></a>Additional resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="configuring-openapi-services-endpoints.html" class="xref page">Configuring OpenAPI services endpoints</a></p>
</li>
<li>
<p><a href="../security/authention-support-for-openapi-services.html" class="xref page">Authentication for OpenAPI services in OpenShift Serverless Logic</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_found_an_issue"><a class="anchor" href="#_found_an_issue"></a><em><strong>Found an issue?</strong></em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you find an issue or any misleading information, please feel free to report it <a href="https://github.com/kiegroup/kogito-docs/issues/new">here</a>.
We really appreciate it!</p>
</div>
</div>
</div>
</article>
        </main>
            </div>
  </div>
</div><footer class="footer">
  <p>Adapted from Antora default UI, (c) 2019</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/tabsBehavior.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
