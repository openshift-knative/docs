<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consuming and producing events on Knative Eventing :: Red Hat OpenShift Serverless previews</title>
    <link rel="canonical" href="https://openshift-knative.github.io/docs/docs/main/eventing/consume-produce-events-with-knative-eventing.html">
    <meta name="description" content="Consuming and producing events on Knative Eventing">
    <meta name="keywords" content="kogito, workflow, serverless, events, knative, cloudevents">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="stylesheet" href="../../../_/css/extra.css">
<link rel="stylesheet" href="../../../_/css/custom.css">
<link rel="stylesheet" href="../../../_/css/tabs.css">
<link rel="stylesheet" href="../../../_/font-awesome-4.7.0/css/font-awesome.min.css">
<!--
<link rel="icon" href="../../../favicon.ico" type="image/x-icon">
-->
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <button class="navbar-burger" data-target="topbar-nav">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <img src="../../../_/img/serverless-icon.svg" class="navbar-logo" alt="OpenShift Serverless icon">
        <a href="">OpenShift Serverless Previews</a>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- search broken
        <div class="navbar-item hide-for-print">
          <script async src="https://cse.google.com/cse.js?cx=002898025167115630151:gnr5edrg2eo"></script>
          <div class="gcse-searchbox" enableAutoComplete="true"></div>
        </div>
      -->
        <a class="navbar-item" href="https://openshift-knative.github.io/docs/docs/index.html">Home</a>
        <a class="navbar-item" href="https://developers.redhat.com/topics/serverless-architecture">Blog</a>
        <a class="navbar-item" href="https://github.com/boson-project/">The Boson Project</a>
      </div>
    </div>
  </nav>
<!-- need alt search type-->
<!--<div class="gcse-searchresults"></div>-->
</header>
<div class="main-wrapper">
  <div class="navigation-container" data-component="docs" data-version="main">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../about.html">About</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Workflows</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/create-your-first-workflow-service.html">Creating your first workflow service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/cncf-serverless-workflow-specification-support.html">CNCF Serverless Workflow specification</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../getting-started/getting-familiar-with-our-tooling.html">Getting familiar with OpenShift Serverless Logic tooling</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Core</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/understanding-jq-expressions.html">jq expressions in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/understanding-workflow-error-handling.html">Error handling in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/working-with-parallelism.html">Parallelism in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/configuration-properties.html">Configuration properties in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/custom-functions-support.html">Custom functions for your OpenShift Serverless Logic service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Tooling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-overview.html">Serverless Workflow editor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-vscode-extension.html">VS Code extension for Serverless Workflow editor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/serverless-workflow-editor/swf-editor-chrome-extension.html">Chrome GitHub extension for Serverless Workflow editor</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-overview.html">Kogito Serverless Workflow Tools extension in Quarkus Dev UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-instances-page.html">Workflow Instances in Kogito Serverless Workflow Tools extension</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tooling/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-definition-page.html">Workflow Definitions in Kogito Serverless Workflow Tools extension</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tooling/kn-plugin-workflow-overview.html">OpenShift Serverless Logic plug-in for Knative CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <span class="nav-text">Service Orchestration</span>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../service-orchestration/orchestration-of-openapi-based-services.html">Orchestrating the OpenAPI services</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../service-orchestration/configuring-openapi-services-endpoints.html">Configuring the OpenAPI services endpoints</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../service-orchestration/orchestration-of-grpc-services.html">Orchestration of gRPC based services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Eventing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="handling-events-on-workflows.html">Event state in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="consume-producing-events-with-kafka.html">Consuming and producing events using Apache Kafka</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="consume-produce-events-with-knative-eventing.html">Consuming and producing events on Knative Eventing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="event-correlation-with-workflows.html">Event correlation in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="working-with-callbacks.html">Callback state in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security/authention-support-for-openapi-services.html">Authentication for OpenAPI services in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../security/orchestrating-third-party-services-with-oauth2.html">Orchestration of third-party services using OAuth 2.0 authentication in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Testing and Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../testing-and-troubleshooting/mocking-http-cloudevents-with-wiremock.html">Mocking HTTP CloudEvents sink using WireMock</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../testing-and-troubleshooting/mocking-openapi-services-with-wiremock.html">Mocking OpenAPI services using WireMock</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../testing-and-troubleshooting/basic-integration-tests-with-restassured.html">Testing your workflow application using REST Assured</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../testing-and-troubleshooting/integration-tests-with-postgresql.html">OpenShift Serverless Logic integration test using PostgreSQL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../persistence/persistence-with-postgresql.html">Running a workflow service using PostgreSQL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Cloud</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cloud/build-workflow-image-with-quarkus-cli.html">Building workflow images using Quarkus CLI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../cloud/deploying-on-minikube.html">Deploying your OpenShift Serverless Logic application on Minikube</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../integrations/serverless-dashboard-with-runtime-data.html">Displaying workflow data in dashboards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Use Cases</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../use-cases/orchestration-based-saga-pattern.html">Saga orchestration example in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Documentation</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Documentation</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../index.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <div class="main-view-and-toolbar">
    <div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../index.html">Documentation</a></li>
    <li class="crumb">Workflows</li>
    <li class="crumb">Eventing</li>
    <li class="crumb"><a href="consume-produce-events-with-knative-eventing.html">Consuming and producing events on Knative Eventing</a></li>
  </ul>
</nav>
</div>
    <div class="main-view-and-toc">
        <main class="main">
          <article class="doc">
<h1>Consuming and producing events on Knative Eventing</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document describes how you can configure a workflow to interact with <a href="https://knative.dev/docs/eventing/">Knative Eventing</a>.</p>
</div>
<div class="paragraph">
<p>Knative Eventing abstracts the events consumption through <a href="https://knative.dev/docs/eventing//sources">event source</a> and <a href="https://knative.dev/docs/eventing//sinks">sink</a> components. An event source is a Kubernetes object that produces the event, and a sink is another Kubernetes object that receives the event. The workflow application can act as a source, a sink, or both in Knative Eventing platform.</p>
</div>
<div class="paragraph">
<p>You need to add the Kogito Knative Eventing add-on dependency to indicate that you are using Knative Eventing. To enable a workflow to use Knative Eventing, add the following dependency to the <code>pom.xml</code> file of your project:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_apache-maven"></a>Apache Maven</p>
</li>
<li>
<p><a id="tabset1_quarkus-cli"></a>Quarkus CLI</p>
</li>
<li>
<p><a id="tabset1_manually"></a>Manually</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_apache-maven">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn quarkus:add-extension -Dextensions="kogito-addons-quarkus-knative-eventing"</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_quarkus-cli">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">quarkus extension add kogito-addons-quarkus-knative-eventing</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_manually">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.kie.kogito&lt;/groupId&gt;
    &lt;artifactId&gt;kogito-addons-quarkus-knative-eventing&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have used the Knative workflow CLI to create your project, then the Kogito Knative Eventing extension is already present. For more information about creating a project using Knative workflow CLI, see <a href="../tooling/kn-plugin-workflow-overview.html" class="xref page">OpenShift Serverless Logic plug-in for Knative CLI</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Kogito Knative Eventing add-on takes care of the required dependencies and additional configuration that the workflow application needs, to interact with the Knative Eventing platform.</p>
</div>
<div class="paragraph">
<p>Although the default configuration that the Quarkus Knative Eventing add-on provides ought to be enough for most of the use cases, sometimes you might need to do additional configuration to serve a specific scenario.</p>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#ref-knative-eventing-add-on-source-configuration">Knative Eventing add-on source configuration</a></li>
<li><a href="#ref-knative-eventing-add-on-sink-configuration">Knative Eventing add-on sink configuration</a></li>
<li><a href="#proc-generating-kn-objects-build-time">Generating Knative objects during build time</a></li>
<li><a href="#ref-example-sw-event-definition-knative">Example of workflow event definition in Knative</a></li>
<li><a href="#_additional_resources">Additional resources</a></li>
<li><a href="#_found_an_issue"><em><strong>Found an issue?</strong></em></a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="ref-knative-eventing-add-on-source-configuration"><a class="anchor" href="#ref-knative-eventing-add-on-source-configuration"></a>Knative Eventing add-on source configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration described in this section is useful if your workflow consists of at least one <code>produced</code> type <a href="https://github.com/serverlessworkflow/specification/blob/0.8.x/specification.md#Event-Definition">event definition</a>. In this scenario, the workflow application produces events that act as a Knative source.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">HTTP transport configuration</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Knative injects the <code>K_SINK</code> environment variable in the workflow application when you deploy the application in the cluster. OpenShift Serverless Logic uses the <code>K_SINK</code> environment variable to address the produced events to the correct Knative sink. For more information, see <a href="https://knative.dev/docs/eventing//custom-event-source/sinkbinding/">SinkBinding</a> in Knative Eventing documentation.</p>
</div>
<div class="paragraph">
<p>The following table lists the HTTP transport configuration properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. HTTP transport configuration properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mp.messaging.outgoing.kogito_outgoing_stream.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${K_SINK:http://localhost:9090}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property indicates where to POST the HTTP CloudEvent message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mp.messaging.outgoing.kogito_outgoing_stream.connector</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quarkus-http</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property indicates the Quarkus Smallrye channel implementation. You might not need to change this property.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the <code>K_SINK</code> variable is not present, then the default value is <code><a href="http://localhost:9000" class="bare">localhost:9000</a></code>. You can override the default value in development environments.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Health check configuration</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>By default, the workflow application generates a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">health check probe</a> to verify if the Knative platform injected a valid <code>K_SINK</code> variable. If the <code>K_SINK</code> variable is not present, then the pod is not in the state of receiving requests.</p>
</div>
<div class="paragraph">
<p>The following table lists the health check probe configuration property:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Health check probe configuration property</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.kogito.addons.knative.health_enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property indicates if the health check is enabled to verify that the <code>K_SINK</code> variable is injected into the environment.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
<dt class="hdlist1">Knative target sink generation configuration</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Kogito Knative Eventing add-on generates a few Knative objects during build time. By default, the add-on generates a <a href="https://knative.dev/docs/eventing//broker">Knative Broker</a> named <code>default</code> if the workflow application is acting as an event source.</p>
</div>
<div class="paragraph">
<p>The following table lists the configuration properties related to Knative sink generation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Knative sink generation configuration properties</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.kogito.addons.knative.auto_generate_broker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property indicates if the Kogito Knative Eventing add-on generates a default Knative Broker in memory to sink and dispatch the messages. Set this property to <code>false</code> in case a broker is already installed in your namespace. Note that you can use <code>org.kie.kogito.addons.knative.eventing.sink.*</code> property to configure your custom sink. If this property is not set, then the auto-generated broker works as a sink.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.kogito.addons.knative.sink.namespace</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property indicates the namespace where the generated Knative sink is deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.kogito.addons.knative.sink.api_version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eventing.knative.dev/v1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property indicates the API group and version of the generated Knative sink.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.kogito.addons.knative.sink.name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property indicates the name of the generated Knative sink.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.kogito.addons.knative.sink.kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Broker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property indicates the Kubernetes kind of the generated Knative sink.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ref-knative-eventing-add-on-sink-configuration"><a class="anchor" href="#ref-knative-eventing-add-on-sink-configuration"></a>Knative Eventing add-on sink configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The configuration described in this section is useful if your workflow consists of at least one <code>consumed</code> type <a href="https://github.com/serverlessworkflow/specification/blob/0.8.x/specification.md#Event-Definition">event definition</a>. In this scenario, the workflow application consumes events, acting as a Knative sink.</p>
</div>
<div class="paragraph">
<p>When the workflow application needs to consume events, the Knative Eventing add-on generates <a href="https://knative.dev/docs/eventing//broker/triggers">Knative triggers</a>. The Knative triggers are configured to listen to a broker with the required event type, which is defined in your workflow definition.</p>
</div>
<div class="paragraph">
<p>The following table lists the configuration property related to Knative sink generation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Knative sink generation configuration property</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.kie.kogito.addons.knative.broker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This property indicates the name of the default Knative broker that is deployed in the Kubernetes namespace. This broker is used as the reference to create the Knative triggers, which are responsible to delegate the events that the workflow service consumes.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="proc-generating-kn-objects-build-time"><a class="anchor" href="#proc-generating-kn-objects-build-time"></a>Generating Knative objects during build time</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenShift Serverless Logic can generate Knative objects during the workflow application build time to facilitate the deployment in a Kubernetes cluster. However, you do not need to use the generated objects if you plan to create and deploy the Knative objects by yourself.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A workflow application with the Knative Eventing add-on is created.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the following <a href="https://quarkus.io/guides/deploying-to-kubernetes">Quarkus Kubernetes extension</a> dependency to the <code>pom.xml</code> file of your project:</p>
<div class="openblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_apache-maven"></a>Apache Maven</p>
</li>
<li>
<p><a id="tabset2_quarkus-cli"></a>Quarkus CLI</p>
</li>
<li>
<p><a id="tabset2_manually"></a>Manually</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_apache-maven">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn quarkus:add-extension -Dextensions="quarkus-kubernetes,quarkus-container-image-jib"</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_quarkus-cli">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">quarkus extension add quarkus-kubernetes quarkus-container-image-jib</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_manually">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-kubernetes&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-container-image-jib&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Add the <code>quarkus.kubernetes.deployment-target=knative</code> property to your <code>application.properties</code> file.</p>
</li>
<li>
<p>Build your workflow application using the following command:</p>
<div class="openblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset3_apache-maven"></a>Apache Maven</p>
</li>
<li>
<p><a id="tabset3_quarkus-cli"></a>Quarkus CLI</p>
</li>
<li>
<p><a id="tabset3_knative-cli"></a>Knative CLI</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset3_apache-maven">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">mvn clean install</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_quarkus-cli">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">quarkus build</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset3_knative-cli">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kn workflow build --image=&lt;name&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The <code>target/kubernetes</code> directory contains two files including <code>knative.yml</code> and <code>kogito.yml</code>. The <code>knative.yml</code> file contains the <a href="https://knative.dev/docs/serving/services/">Knative service</a> representing the workflow application. The <code>kogito.yml</code> file contains the required objects to connect the workflow application to the Knative Eventing platform.</p>
</div>
</div>
</div>
</li>
<li>
<p>You can use the generated files to deploy the workflow application in the Kubernetes cluster using the following command:</p>
<div class="openblock">
<div class="content">
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset4_kubernetes-command-line-tool"></a>Kubernetes command line tool</p>
</li>
<li>
<p><a id="tabset4_knative-cli"></a>Knative CLI</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset4_kubernetes-command-line-tool">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl apply -f target/kogito.yml
kubectl apply -f target/knative.yml</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset4_knative-cli">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kn workflow deploy</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information about building and deploying the workflow application, see <a href="../cloud/build-workflow-image-with-quarkus-cli.html" class="xref page">Building workflow images using Quarkus CLI</a>.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ref-example-sw-event-definition-knative"><a class="anchor" href="#ref-example-sw-event-definition-knative"></a>Example of workflow event definition in Knative</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A workflow must contain at least one event definition for the Knative Eventing add-on to generate the event binding objects. The following is an example of a workflow containing produced and consumed events:</p>
</div>
<div class="listingblock">
<div class="title">Example of a workflow with produced and consumed events</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "events": [
    {
      "name": "requestQuote",
      "type": "kogito.sw.request.quote",
      "kind": "produced"
    },
    {
      "name": "aggregatedQuotesResponse",
      "type": "kogito.loanbroker.aggregated.quotes.response",
      "kind": "consumed",
      "source": "/kogito/serverless/loanbroker/aggregator"
    }]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A workflow application with events definition needs a Knative <code>SinkBinding</code> to configure the target sink. The target sink is where the produced events (<code>kogito.sw.request.quote</code> event in the previous example) are dispatched. In this case, the Knative Eventing add-on generates an object as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="title">Example of a Knative <code>SinkBinding</code> generated by the add-on</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sources.knative.dev/v1
kind: SinkBinding
metadata:
  name: sb-loanbroker-flow
spec:
  sink:
    ref:
      apiVersion: eventing.knative.dev/v1
      kind: Broker
      name: default
      namespace: ""
  subject:
    apiVersion: serving.knative.dev/v1
    kind: Service
    name: loanbroker-flow</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Regardless of the number of produced events in the workflow definition, only one <code>SinkBinding</code> is generated. When you define multiple events, ensure that your sink is a Knative Broker. The listener services can configure the subscriptions or triggers to consume the events from the broker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the <code>kogito.loanbroker.aggregated.quotes.response</code> event in a previous example, the Knative Eventing platform must be configured with a Knative trigger using an appropriate CloudEvent filter. The following example shows the <code>Trigger</code> generated by the Knative Eventing add-on:</p>
</div>
<div class="listingblock">
<div class="title">Example of a Knative <code>Trigger</code> generated by the add-on</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
  name: kogito-serverless-loanbroker-aggregated-quotes-response-trigger
spec:
  broker: default
  filter:
    attributes:
      type: kogito.loanbroker.aggregated.quotes.response
  subscriber:
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: loanbroker-flow</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each consumed event definition, the Knative Eventing add-on generates one Knative <code>Trigger</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources"><a class="anchor" href="#_additional_resources"></a>Additional resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="../testing-and-troubleshooting/mocking-http-cloudevents-with-wiremock.html" class="xref page">Mocking HTTP CloudEvents sink using WireMock</a></p>
</li>
<li>
<p><a href="consume-producing-events-with-kafka.html" class="xref page">Consuming and producing events using Apache Kafka</a></p>
</li>
<li>
<p><a href="event-correlation-with-workflows.html" class="xref page">Event correlation in OpenShift Serverless Logic</a></p>
</li>
<li>
<p><a href="working-with-callbacks.html" class="xref page">Callback state in OpenShift Serverless Logic</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_found_an_issue"><a class="anchor" href="#_found_an_issue"></a><em><strong>Found an issue?</strong></em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you find an issue or any misleading information, please feel free to report it <a href="https://github.com/kiegroup/kogito-docs/issues/new">here</a>.
We really appreciate it!</p>
</div>
</div>
</div>
</article>
        </main>
            </div>
  </div>
</div><footer class="footer">
  <p>Adapted from Antora default UI, (c) 2019</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/tabsBehavior.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
