<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building and Deploying Workflows with the Operator :: Red Hat OpenShift Serverless previews</title>
    <link rel="canonical" href="https://openshift-knative.github.io/docs/docs/latest/serverless-logic/cloud/operator/build-and-deploy-workflows.html">
    <meta name="description" content="Build and deploy with Serverless Logic Operator">
    <meta name="keywords" content="kogito, sonataflow, workflow, serverless, operator, kubernetes, minikube, openshift, containers">
    <meta name="generator" content="Antora 3.0.3">
    <link rel="stylesheet" href="../../../../../_/css/site.css">
<link rel="stylesheet" href="../../../../../_/css/extra.css">
<link rel="stylesheet" href="../../../../../_/css/custom.css">
<link rel="stylesheet" href="../../../../../_/css/tabs.css">
<link rel="stylesheet" href="../../../../../_/font-awesome-4.7.0/css/font-awesome.min.css">
<link rel="icon" href="../../../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <button class="navbar-burger" data-target="topbar-nav">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <img src="../../../../../_/img/serverless-icon.png" class="navbar-logo" alt="OpenShift Serverless icon">
        <a href="">OpenShift Serverless - Technology and Developer Preview Releases</a>
      </div>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- search broken
        <div class="navbar-item hide-for-print">
          <script async src="https://cse.google.com/cse.js?cx=002898025167115630151:gnr5edrg2eo"></script>
          <div class="gcse-searchbox" enableAutoComplete="true"></div>
        </div>
      -->
        <a class="navbar-item" href="https://openshift-knative.github.io/docs">Home</a>
        <a class="navbar-item" href="https://developers.redhat.com/topics/serverless-architecture">Blog</a>
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Upstream Projects</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" href="https://kogito.kie.org/">Kogito</a>
                  <a class="navbar-item" href="https://knative.dev/docs/functions/">Knative Functions</a>
                  <a class="navbar-item" href="https://knative.dev/docs/eventing/">Knative Eventing</a>
              </div>
          </div>
      </div>
    </div>
  </nav>
<!-- need alt search type-->
<!--<div class="gcse-searchresults"></div>-->
</header>
<div class="main-wrapper">
  <div class="navigation-container" data-component="docs" data-version="main">
  <aside class="navigation">
    <div class="panels">
<div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../index.html">Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../index.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serverless</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Using OpenShift Serverless with OpenShift Service Mesh</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../serverless/service-mesh/common-service-mesh-setup.html">Setup Serverless with OpenShift Service Mesh</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../serverless/service-mesh/common-service-mesh-network-isolation.html">Use Service Mesh to isolate network-traffic</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../serverless/service-mesh/eventing-service-mesh-containersource.html">Eventing: Using ContainerSource with OpenShift Service Mesh</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../serverless/service-mesh/eventing-service-mesh-sinkbinding.html">Eventing: Using SinkBinding with OpenShift Service Mesh</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Eventing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../serverless/eventing/transport-encryption-setup.html">Setup transport encryption in Eventing</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../serverless/eventing/kafka-scaling-setup.html">Setup Autoscaling For Eventing Kafka Components</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serving</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../serverless/serving/serving-with-ingress-sharding.html">Use Serving with OpenShift ingress sharding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../serverless/serving/scaleability-and-performance-of-serving.html">Scalability and performance of OpenShift Serverless Serving</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../serverless/serving/serving-transport-encryption.html">Serving Transport Encryption</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Serverless Logic</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../about.html">About OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../release-notes.html">Release notes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <span class="nav-text">User Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Setup</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../getting-started/learning-environment.html">Learning environment</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../getting-started/preparing-environment.html">Environment setup</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../getting-started/production-environment.html">Production environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../getting-started/create-your-first-workflow-service-with-kn-cli-and-vscode.html">Creating your first workflow service with KN CLI and VS Code</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../getting-started/getting-familiar-with-our-tooling.html">Getting familiar with tooling</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Core</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/cncf-serverless-workflow-specification-support.html">CNCF Serverless Workflow specification</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/handling-events-on-workflows.html">Events</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/working-with-callbacks.html">Callbacks</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/understanding-jq-expressions.html">jq expressions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/understanding-workflow-error-handling.html">Error handling</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/configuration-properties.html">Configuration properties</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/defining-an-input-schema-for-workflows.html">Defining an input schema for your workflows</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/custom-functions-support.html">Custom functions for your service</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/timeouts-support.html">Timeouts</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../core/working-with-parallelism.html">Parallelism</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Tooling</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../tooling/serverless-workflow-editor/swf-editor-overview.html">Editor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tooling/serverless-workflow-editor/swf-editor-vscode-extension.html">VS Code extension</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tooling/serverless-workflow-editor/swf-editor-chrome-extension.html">Chrome extension for GitHub</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-overview.html">Serverless Logic Web Tools</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-github-integration.html">GitHub integration</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-openshift-integration.html">OpenShift integration</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-redhat-application-services-integration.html">Red Hat OpenShift Application and Data Services integration</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../tooling/serverless-logic-web-tools/serverless-logic-web-tools-deploy-projects.html">Deploying projects</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Service Orchestration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../service-orchestration/orchestration-of-openapi-based-services.html">Orchestrating the OpenAPI services</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../service-orchestration/configuring-openapi-services-endpoints.html">Configuring the OpenAPI services endpoints</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../service-orchestration/working-with-openapi-callbacks.html">OpenAPI callback  in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../service-orchestration/troubleshooting.html">Troubleshooting</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Event Orchestration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../eventing/orchestration-of-asyncapi-based-services.html">Orchestrating AsyncAPI Services</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../eventing/event-correlation-with-workflows.html">Event Correlation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../security/authention-support-for-openapi-services.html">Authentication for OpenAPI services</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../security/orchestrating-third-party-services-with-oauth2.html">Orchestration of third-party services using OAuth 2.0 authentication</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Executing, Testing and Troubleshooting</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-toggle"></button>
    <span class="nav-text">Executing and Testing Workflows</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-overview.html">Developer UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-instances-page.html">Workflow Instances</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-workflow-definition-page.html">Workflow Definitions</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-monitoring-page.html">Monitoring</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../testing-and-troubleshooting/quarkus-dev-ui-extension/quarkus-dev-ui-custom-dashboard-page.html">Dashboards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../testing-and-troubleshooting/kn-plugin-workflow-overview.html">Command Line</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../persistence/core-concepts.html">Core concepts</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../index.html">Cloud</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-toggle"></button>
    <span class="nav-text">Operator</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="install-serverless-operator.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="developing-workflows.html">Development Mode</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="referencing-resource-files.html">Referencing Workflow Resources</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="configuring-workflows.html">Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="5">
    <a class="nav-link" href="build-and-deploy-workflows.html">Building and Deploying Workflows</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="supporting-services.html">Deploy Supporting Services</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="workflow-status-conditions.html">Custom Resource Status</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="building-custom-images.html">Building Custom Images</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="customize-podspec.html">Custom Workflow PodSpec</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="service-discovery.html">Service Discovery</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="using-persistence.html">Using persistence</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="configuring-knative-eventing-resources.html">Knative Eventing</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="known-issues.html">Roadmap and Known Issues</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Integrations</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../integrations/core-concepts.html">Introduction</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Supporting Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-toggle"></button>
    <span class="nav-text">Data Index</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../data-index/data-index-core-concepts.html">Core Concepts</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../data-index/data-index-service.html">Data Index Standalone Service</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-toggle"></button>
    <span class="nav-text">Use Cases</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/index.html">Development of OpenShift Serverless Logic applications using Quarkus and Java</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Getting Started</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/getting-started/create-your-first-workflow-service.html">Creating your first workflow service</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/getting-started/build-workflow-image-with-quarkus-cli.html">Building workflow images using Quarkus CLI</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/getting-started/working-with-serverless-workflow-quarkus-examples.html">Working with OpenShift Serverless Logic example applications</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/getting-started/test-serverless-workflow-quarkus-examples.html">Testing images of OpenShift Serverless Logic example applications using Quarkus CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Deployment</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/deployments/deploying-on-minikube.html">Deploying on Minikube</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/deployments/deploying-on-kubernetes.html">Deploying on Kubernetes</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/deployments/deploying-on-openshift.html">Deploying on OpenShift</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/persistence/persistence-core-concepts.html">Core Concepts</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/persistence/persistence-with-postgresql.html">Running a Quarkus Workflow Application using PostgreSQL</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/persistence/postgresql-advanced-concepts.html">Postgresql Advanced Concepts</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/persistence/postgresql-flyway-migration.html">PostgreSQL Database Migration</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/persistence/integration-tests-with-postgresql.html">OpenShift Serverless Logic integration test using PostgreSQL</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Data Index</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/data-index/data-index-as-quarkus-dev-service.html">Data Index as a Quarkus Development service</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/data-index/data-index-usecase-singleton.html">Deploying Data Index and OpenShift Serverless Logic application on Minikube</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/data-index/data-index-usecase-multi.html">Deploying Data Index and multiple OpenShift Serverless Logic applications on Minikube</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/data-index/data-index-quarkus-extension.html">Data Index Quarkus extensions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Service Orchestration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/service-orchestration/configuring-openapi-services-endpoints-with-quarkus.html">Configuring the OpenAPI services endpoints in different environments</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/service-orchestration/orchestration-of-grpc-services.html">Orchestrating gRPC based Services</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Service Discovery</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/service-discovery/kubernetes-service-discovery.html">Kubernetes service discovery in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Event Orchestration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/event-orchestration/consume-produce-events-with-knative-eventing.html">Consuming and producing events on Knative Eventing in Quarkus</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/event-orchestration/consume-producing-events-with-kafka.html">Consuming and producing events using Apache Kafka in Quarkus</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/event-orchestration/orchestration-based-saga-pattern.html">Saga orchestration example in OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/event-orchestration/newsletter-subscription-example.html">Newsletter subscription example in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Timeouts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/timeouts/timeout-showcase-example.html">Timeouts Showcase in OpenShift Serverless Logic</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Callbacks</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/callbacks/callback-state-example.html">Example of OpenShift Serverless Logic application using callback state with Quarkus</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Integrations of external services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/integrations/camel-routes-integration.html">Integrating with Camel routes</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/integrations/custom-functions-knative.html">Invoking Knative services from OpenShift Serverless Logic</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/integrations/expose-metrics-to-prometheus.html">Exposing Workflow base metrics to Prometheus</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/integrations/serverless-dashboard-with-runtime-data.html">Displaying Workflow Data in Dashboards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="5">
    <button class="nav-toggle"></button>
    <span class="nav-text">Testing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/testing/basic-integration-tests-with-restassured.html">Testing your Quarkus Workflow Application using REST Assured</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/testing/mocking-http-cloudevents-with-wiremock.html">Mocking HTTP CloudEvents sink using WireMock</a>
  </li>
  <li class="nav-item" data-depth="6">
    <a class="nav-link" href="../../use-cases/advanced-developer-use-cases/testing/mocking-openapi-services-with-wiremock.html">Mocking OpenAPI services using WireMock</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <span class="nav-text">Buildpacks for Serverless Functions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../functions/serverless-functions-about.html">About buildpacks for OpenShift Serverless Functions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../functions/serverless-functions-buildpacks.html">Building and deploying functions on the cluster</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="navigation-explore" data-panel="explore">
  <div class="context">
    <span class="title">Documentation</span>
    <span class="version">main</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Documentation</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../../../index.html">main</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <div class="main-view-and-toolbar">
    <div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="../../../index.html" class="home-link"></a>
<nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="../../../index.html">Documentation</a></li>
    <li class="crumb">Serverless Logic</li>
    <li class="crumb">User Guides</li>
    <li class="crumb"><a href="../index.html">Cloud</a></li>
    <li class="crumb">Operator</li>
    <li class="crumb"><a href="build-and-deploy-workflows.html">Building and Deploying Workflows</a></li>
  </ul>
</nav>
</div>
    <div class="main-view-and-toc">
        <main class="main">
          <article class="doc">
<h1>Building and Deploying Workflows with the Operator</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document describes how to build and deploy your workflow on a cluster using the <a href="https://github.com/kiegroup/kogito-serverless-operator/tree/9.99.x-prod">Serverless Logic Operator</a> only by having a <code>SonataFlow</code> custom resource.</p>
</div>
<div class="paragraph">
<p>Every time you need to change the workflow definition the system will (re)build a new immutable version of the workflow. If you&#8217;re still in development phase, please see the <a href="developing-workflows.html" class="xref page">Developing Workflows with the Operator</a> guide.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The build system implemented by the Serverless Logic Operator is not suitable for complex production use cases. Consider using an external tool to build your application such as Tekton and ArgoCD. The resulting image can then be deployed with <code>SonataFlow</code> custom resource. See more at <a href="customize-podspec.html#custom-image-default-container" class="xref page">Setting a custom image in the default container</a> section in the <a href="customize-podspec.html#custom-image-default-container" class="xref page">cloud/operator/customize-podspec.adoc#custom-image-default-container</a> guide.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Follow the <a href="#building-kubernetes">Kubernetes</a> or <a href="#building-openshift">OpenShift</a> sections of this document based on the cluster you wish to build your workflows on.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A Workflow definition.</p>
</li>
<li>
<p>The Serverless Logic Operator installed. See <a href="install-serverless-operator.html" class="xref page">Install the Serverless Logic Operator</a> guide</p>
</li>
</ul>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#configure-build-system">Configuring the build system</a>
<ul class="sectlevel2">
<li><a href="#_using_another_workflow_base_builder_image">Using another Workflow base builder image</a></li>
<li><a href="#_customize_the_base_build_dockerfile">Customize the base build Dockerfile</a></li>
<li><a href="#_changing_resources_requirements">Changing resources requirements</a></li>
<li><a href="#_passing_arguments_to_the_internal_builder">Passing arguments to the internal builder</a></li>
<li><a href="#_setting_environment_variables_in_the_internal_builder">Setting environment variables in the internal builder</a></li>
</ul>
</li>
<li><a href="#building-kubernetes">Building on Kubernetes</a>
<ul class="sectlevel2">
<li><a href="#_create_a_namespace_for_the_building_phase">Create a Namespace for the building phase</a></li>
<li><a href="#_create_a_secret_for_the_container_registry_authentication">Create a Secret for the container registry authentication</a></li>
<li><a href="#_configure_the_serverless_logic_operator_i_e_registry_address_secret_for_building_your_workflows">Configure the Serverless Logic Operator (i.e. registry address, secret) for building your Workflows</a></li>
</ul>
</li>
<li><a href="#building-openshift">Building on OpenShift</a>
<ul class="sectlevel2">
<li><a href="#_changing_the_base_builder_image">Changing the base builder image</a></li>
</ul>
</li>
<li><a href="#build-deploy-workflow">Build and deploy your workflow</a></li>
<li><a href="#_check_if_the_workflow_is_running">Check if the Workflow is running</a></li>
<li><a href="#_restarting_a_build">Restarting a build</a></li>
<li><a href="#_additional_resources">Additional resources</a></li>
<li><a href="#_found_an_issue"><em><strong>Found an issue?</strong></em></a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="configure-build-system"><a class="anchor" href="#configure-build-system"></a>Configuring the build system</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The operator can build workflows on Kubernetes or OpenShift. On Kubernetes, it uses <a href="https://github.com/GoogleContainerTools/kaniko">Kaniko</a> and on OpenShift a <a href="https://docs.openshift.com/container-platform/4.13/cicd/builds/understanding-image-builds.html">standard BuildConfig</a>. The operator build system is not tailored for advanced production use cases and you can do only a few customizations.</p>
</div>
<div class="sect2">
<h3 id="_using_another_workflow_base_builder_image"><a class="anchor" href="#_using_another_workflow_base_builder_image"></a>Using another Workflow base builder image</h3>
<div class="paragraph">
<p>If your scenario has strict policies for image usage, such as security or hardening constraints, you can replace the default image used by the operator to build the final workflow container image. Alternatively, you might want to test a nightly build with a bug fix or a custom image containing your customizations.</p>
</div>
<div class="paragraph">
<p>By default, the operator will use the image distributed upstream to build workflows. You can change this image by editing the <code>SonataFlowPlatform</code> custom resource in the namespace where you deployed your workflows:</p>
</div>
<div class="listingblock">
<div class="title">Patching the current SonataFlowPlatform with the new builder image</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># use `kubectl get sonataflowplatform` to get the SonataFlowPlatform name
kubectl patch sonataflowplatform &lt;name&gt; --patch  'spec:\n    build:\n    config:\n    baseImage: &lt;your new image full name with tag&gt;' -n &lt;your_namespace&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customize_the_base_build_dockerfile"><a class="anchor" href="#_customize_the_base_build_dockerfile"></a>Customize the base build Dockerfile</h3>
<div class="paragraph">
<p>The operator uses the sonataflow-operator-builder-config <code>ConfigMap</code> in the operator&#8217;s installation namespace (sonataflow-operator-system) to configure and run the workflow build process.
You can change the <code>Dockerfile</code> entry in this <code>ConfigMap</code> to tailor the Dockerfile to your needs. Just be aware that this can break the build process.</p>
</div>
<div class="listingblock">
<div class="title">Example of the sonataflow-operator-builder-config <code>ConfigMap</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
data:
  DEFAULT_BUILDER_RESOURCE_NAME: Dockerfile
  DEFAULT_WORKFLOW_EXTENSION: .sw.json
  Dockerfile: "FROM registry.redhat.io/openshift-serverless-1-tech-preview/logic-data-index-ephemeral-rhel8:latest AS builder\n\n#
    variables that can be overridden by the builder\n# To add a Quarkus extension
    to your application\nARG QUARKUS_EXTENSIONS\n# Args to pass to the Quarkus CLI
    add extension command\nARG QUARKUS_ADD_EXTENSION_ARGS\n# Additional java/mvn arguments
    to pass to the builder\nARG MAVEN_ARGS_APPEND\n\n# Copy from build context to
    skeleton resources project\nCOPY --chown=1001 . ./resources\n\nRUN /home/kogito/launch/build-app.sh
    ./resources\n  \n#=============================\n# Runtime Run\n#=============================\nFROM
    registry.access.redhat.com/ubi9/openjdk-17:latest\n\nENV LANG='en_US.UTF-8' LANGUAGE='en_US:en'\n
    \ \n# We make four distinct layers so if there are application changes the library
    layers can be re-used\nCOPY --from=builder --chown=185 /home/kogito/serverless-workflow-project/target/quarkus-app/lib/
    /deployments/lib/\nCOPY --from=builder --chown=185 /home/kogito/serverless-workflow-project/target/quarkus-app/*.jar
    /deployments/\nCOPY --from=builder --chown=185 /home/kogito/serverless-workflow-project/target/quarkus-app/app/
    /deployments/app/\nCOPY --from=builder --chown=185 /home/kogito/serverless-workflow-project/target/quarkus-app/quarkus/
    /deployments/quarkus/\n\nEXPOSE 8080\nUSER 185\nENV AB_JOLOKIA_OFF=\"\"\nENV JAVA_OPTS=\"-Dquarkus.http.host=0.0.0.0
    -Djava.util.logging.manager=org.jboss.logmanager.LogManager\"\nENV JAVA_APP_JAR=\"/deployments/quarkus-run.jar\"\n"
kind: ConfigMap
metadata:
  name: sonataflow-operator-builder-config
  namespace: sonataflow-operator-system</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The excerpt above is just an example. The current version might have a slightly different version. Don&#8217;t use this example in your installation.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_changing_resources_requirements"><a class="anchor" href="#_changing_resources_requirements"></a>Changing resources requirements</h3>
<div class="paragraph">
<p>You can create or edit a <code>SonataFlowPlatform</code> in the workflow namespace specifying the <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">resources requirements</a> for the internal builder pods:</p>
</div>
<div class="listingblock">
<div class="title">Example of SonataFlowPlatform</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: sonataflow-platform
spec:
  build:
    template:
      resources:
        requests:
          memory: "64Mi"
          cpu: "250m"
        limits:
          memory: "128Mi"
          cpu: "500m"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Every build process will reuse this configuration and start new instances based on it from now on.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only one <code>SonataFlowPlatform</code> is allowed per namespace. Try fetching the one the operator created for you and edit it instead of trying to create another one.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can fine tune the resources requirements for a particular workflow. Every workflow instance will have a <code>SonataFlowBuild</code> instance created with the same name as the workflow. You can edit the <code>SonataFlowBuild</code> custom resource and specify the same parameters. For example:</p>
</div>
<div class="listingblock">
<div class="title">Example of SonataFlowBuild</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowBuild
metadata:
  name: my-workflow
spec:
    resources:
      requests:
        memory: "64Mi"
        cpu: "250m"
      limits:
        memory: "128Mi"
        cpu: "500m"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This parameters will only apply to new build instances.</p>
</div>
</div>
<div class="sect2">
<h3 id="_passing_arguments_to_the_internal_builder"><a class="anchor" href="#_passing_arguments_to_the_internal_builder"></a>Passing arguments to the internal builder</h3>
<div class="paragraph">
<p>You can pass build arguments (see <a href="https://docs.docker.com/engine/reference/builder/#arg">Dockerfile ARG</a>) to the <code>SonataFlowBuild</code> instance.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create or edit an existing <code>SonataFlowBuild</code> instance. It has the same name of the <code>SonataFlow</code> you&#8217;re trying to build.</p>
<div class="listingblock">
<div class="title">Checking if the SonataFlowBuild instance already exists</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl edit sonataflowbuild/&lt;name&gt; -n &lt;namespace&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Add to the <code>.spec.buildArgs</code> the desired arguments.</p>
<div class="listingblock">
<div class="title">Adding buildArgs to the SonataFlowBuild instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowBuild
metadata:
  name: &lt;name&gt;
spec:
  [...]
  buildArgs:
    - name: ARG1
      value: value1
    - name: ARG2
      value: value2</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file and exit. A new build should start soon with the new configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively, you can set this information in the <code>SonataFlowPlatform</code>, so that every new build instance will use it as a template. For example:</p>
</div>
<div class="listingblock">
<div class="title">Example of a SonataFlowPlatform instance with default build args for every build within the namespace</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: &lt;name&gt;
spec:
  build:
    template:
      buildArgs:
        - name: ARG1
          value: value1
        - name: ARG2
          value: value2</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since the <code>buildArgs</code> attribute is an array of <a href="https://kubernetes.io/docs/tasks/inject-data-application/define-environment-variable-container/">Kubernetes <code>EnvVar</code> object</a>, you can refer to a <code>ConfigMap</code> or <code>Secret</code> to pass this value, for example. You&#8217;re not restricted by a plain value.</p>
</div>
<div class="paragraph">
<p>On Minikube and Kubernetes only plain values, <code>ConfigMap</code> and <code>Secret</code> are supported due to a restriction on the build system provided by these platforms.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The table below lists the Dockerfile arguments available in the default Serverless Logic Operator installation:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Default ARG definitions in the builder Dockerfile</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUARKUS_EXTENSIONS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of <a href="https://quarkus.io/extensions/">Quarkus Extensions</a> separated by comma that the builder should add to the workflow.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.kie.kogito:kogito-addons-quarkus-persistence-jdbc:999-SNAPSHOT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">QUARKUS_ADD_EXTENSION_ARGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arguments passed to the Quarkus CLI when adding extensions. Enabled only when <code>QUARKUS_EXTENSIONS</code> is not empty.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See the <a href="https://quarkus.io/guides/cli-tooling#using-the-cli">Quarkus CLI documentation</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAVEN_ARGS_APPEND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arguments passed to the maven build when the workflow build is produced.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-Dkogito.persistence.type=jdbc -Dquarkus.datasource.db-kind=postgresql</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_setting_environment_variables_in_the_internal_builder"><a class="anchor" href="#_setting_environment_variables_in_the_internal_builder"></a>Setting environment variables in the internal builder</h3>
<div class="paragraph">
<p>You can set environment variables to the <code>SonataFlowBuild</code> internal builder pod.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These environment variables are valid for the build context <strong>only</strong>. They are not set on the final built workflow image.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create or edit an existing <code>SonataFlowBuild</code> instance. It has the same name of the <code>SonataFlow</code> you&#8217;re trying to build.</p>
<div class="listingblock">
<div class="title">Checking if the SonataFlowBuild instance already exists</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl edit sonataflowbuild/&lt;name&gt; -n &lt;namespace&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Add to the <code>.spec.envs</code> the desired data.</p>
<div class="listingblock">
<div class="title">Setting environment variables in the SonataFlowBuild instance</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowBuild
metadata:
  name: &lt;name&gt;
spec:
  [...]
  envs:
    - name: MYENV1
      value: value1
    - name: MYENV2
      value: value2</code></pre>
</div>
</div>
</li>
<li>
<p>Save the file and exit. A new build should start soon with the new configuration.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively, you can set this information in the <code>SonataFlowPlatform</code>, so that every new build instances will use it as a template. For example:</p>
</div>
<div class="listingblock">
<div class="title">Example of a SonataFlowPlatform instance with default envs for every build within the namespace</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: &lt;name&gt;
spec:
  build:
    template:
      envs:
        - name: MYENV1
          value: value1
        - name: MYENV2
          value: value2</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since the <code>envs</code> attribute is an array of <a href="https://kubernetes.io/docs/tasks/inject-data-application/define-environment-variable-container/">Kubernetes <code>EnvVar</code> object</a>, you can refer to a <code>ConfigMap</code> or <code>Secret</code> to pass this value, for example. You&#8217;re not restricted by a plain value.</p>
</div>
<div class="paragraph">
<p>On Minikube and Kubernetes only plain values, <code>ConfigMap</code> and <code>Secret</code> are supported due to a restriction on the build system provided by these platforms.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-kubernetes"><a class="anchor" href="#building-kubernetes"></a>Building on Kubernetes</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can skip this section if you&#8217;re running <a href="#building-openshift">on OpenShift</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Follow these steps to configure your Kubernetes namespace to build workflow images with the operator.</p>
</div>
<div class="sect2">
<h3 id="_create_a_namespace_for_the_building_phase"><a class="anchor" href="#_create_a_namespace_for_the_building_phase"></a>Create a Namespace for the building phase</h3>
<div class="paragraph">
<p>Create a new namespace that will hold all the resources that the operator will create (Pods, Deployments, Services, Secrets, ConfigMap, and Custom Resources) in this guide.</p>
</div>
<div class="listingblock">
<div class="title">Create a Namespace for the workflow to build and run in</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create namespace workflows
# set the workflows namespace to your context
kubectl config set-context --current --namespace=workflows</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_secret_for_the_container_registry_authentication"><a class="anchor" href="#_create_a_secret_for_the_container_registry_authentication"></a>Create a Secret for the container registry authentication</h3>
<div class="paragraph">
<p>You can follow these steps to publish on external registry that requires authentication. If you&#8217;re running on Minikube, just <a href="https://minikube.sigs.k8s.io/docs/handbook/registry/#enabling-insecure-registries">enable the internal registry</a>. You can skip this whole section since the internal Minikube registry doesn&#8217;t require authentication.</p>
</div>
<div class="listingblock">
<div class="title">Create a secret for the container registry authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create secret docker-registry regcred --docker-server=&lt;registry_url&gt; --docker-username=&lt;registry_username&gt; --docker-password=&lt;registry_password&gt; --docker-email=&lt;registry_email&gt; -n workflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>or you can directly import your local Docker config into your Kubernetes cluster:</p>
</div>
<div class="listingblock">
<div class="title">Create a Secret for the container registry authentication based on local Docker config</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl create secret generic regcred --from-file=.dockerconfigjson=${HOME}/.docker/config.json --type=kubernetes.io/dockerconfigjson -n workflows</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Double-check your <code>${HOME}/.docker/config.json</code>. If you&#8217;re using local desktop authentication, this configuration <strong>won&#8217;t work</strong> in the cluster. You can initialize this by logging in to the target registry, e.g. <code>docker login</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configure_the_serverless_logic_operator_i_e_registry_address_secret_for_building_your_workflows"><a class="anchor" href="#_configure_the_serverless_logic_operator_i_e_registry_address_secret_for_building_your_workflows"></a>Configure the Serverless Logic Operator (i.e. registry address, secret) for building your Workflows</h3>
<div class="paragraph">
<p>The <code>SonataFlowPlatform</code> is the Custom Resource used to control the behavior of the Serverless Logic Operator.
It defines the behavior of the operator when handling all OpenShift Serverless Logic Custom Resources (Workflow and Build) in the given namespace.</p>
</div>
<div class="paragraph">
<p>Since the operator is installed in global mode, you will need to specify a <code>SonataFlowPlatform</code> in each Namespace where you want to deploy Workflows.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have deployed a workflow for <a href="developing-workflows.html" class="xref page">development</a> you already have a <code>SonataFlowPlatform</code> custom resource since the operator created one for you. Just edit the one you have.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following is a very basic <code>SonataFlowPlatform</code> Custom Resource example to work on Kubernetes:</p>
</div>
<div class="listingblock">
<div class="title">Example of a basic SonataFlowPlatform on Kubernetes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: sonataflow-platform
spec:
  build:
    config:
      strategyOptions:
        KanikoBuildCacheEnabled: "true"
      registry:
        address: quay.io/kiegroup <i class="conum" data-value="1"></i><b>(1)</b>
        secret: regcred <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Your registry address</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The secret name created in the steps above</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On Minikube, you can remove the <code>registry</code> information entirely since you don&#8217;t need credentials for pushing to the internal registry:</p>
</div>
<div class="listingblock">
<div class="title">Example of a basic SonataFlowPlatform on Minikube</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowPlatform
metadata:
  name: sonataflow-platform
spec:
  build:
    config:
      strategyOptions:
        KanikoBuildCacheEnabled: "true"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>spec.build.config.strategyOptions.KanikoBuildCacheEnabled</code> enables the internal Kaniko process to cache builder images to try to speed up the building execution.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The minikube registry addon must be enabled as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">minikube addons enable registry</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify that the addon was property enabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">minikube addons list |grep registry
| registry                    | minikube | enabled ✅   | minikube                       |
| registry-aliases            | minikube | disabled     | 3rd party (unknown)            |
| registry-creds              | minikube | disabled     | 3rd party (UPMC Enterprises)   |</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can save this file locally and run the following command:</p>
</div>
<div class="listingblock">
<div class="title">Create a <code>SonataFlowPlatform</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f my-sonataflowplatform.yaml -n workflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also update "on-the-fly" the <code>SonataFlowPlatform</code> registry field with this command (change &lt;YOUR_REGISTRY&gt;)</p>
</div>
<div class="listingblock">
<div class="title">Create a <code>SonataFlowPlatform</code> with a specific registry</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat my-sonataflowplatform.yaml | sed "s|address: .*|address: &lt;YOUR_REGISTRY&gt;" | kubectl apply -f -</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building-openshift"><a class="anchor" href="#building-openshift"></a>Building on OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You don&#8217;t need to do anything to build on OpenShift since the operator will configure everything for you. There are a few customizations you can do described in the <a href="#configure-build-system">Configuring the build system</a> section.</p>
</div>
<div class="paragraph">
<p>In general, the operator will create a <a href="https://docs.openshift.com/container-platform/4.13/cicd/builds/understanding-image-builds.html"><code>BuildConfig</code> to build</a> the workflow using the mapped <a href="referencing-resource-files.html" class="xref page">resource files</a> and your workflow definition. After the build is finished, the image will be pushed to the internal OpenShift registry backed by an <code>ImageStream</code> object.</p>
</div>
<div class="sect2">
<h3 id="_changing_the_base_builder_image"><a class="anchor" href="#_changing_the_base_builder_image"></a>Changing the base builder image</h3>
<div class="paragraph">
<p>If you are running on OpenShift, you have access to the Red Hat&#8217;s supported registry. You can change the default builder image by editing the sonataflow-operator-builder-config <code>ConfigMap</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc edit cm/sonataflow-operator-builder-config -n sonataflow-operator-system</code></pre>
</div>
</div>
<div class="paragraph">
<p>In your editor, change the first line in the <code>Dockerfile</code> entry where it reads <code>FROM registry.redhat.io/openshift-serverless-1-tech-preview/logic-data-index-ephemeral-rhel8:1.32.0</code> to the desired image.</p>
</div>
<div class="paragraph">
<p>This image must be compatible with your operator&#8217;s installation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-deploy-workflow"><a class="anchor" href="#build-deploy-workflow"></a>Build and deploy your workflow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can now send your workflow definition (<code>SonataFlow</code>) to the operator.</p>
</div>
<div class="paragraph">
<p>You can find a basic <code>SonataFlow</code> bellow:</p>
</div>
<div class="listingblock">
<div class="title">Example of the greetings workflow example</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlow
metadata:
  name: greeting
  annotations:
    sonataflow.org/description: Greeting example on k8s!
    sonataflow.org/version: 0.0.1
spec:
  flow:
    start: ChooseOnLanguage
    functions:
      - name: greetFunction
        type: custom
        operation: sysout
    states:
      - name: ChooseOnLanguage
        type: switch
        dataConditions:
          - condition: "${ .language == \"English\" }"
            transition: GreetInEnglish
          - condition: "${ .language == \"Spanish\" }"
            transition: GreetInSpanish
        defaultCondition: GreetInEnglish
      - name: GreetInEnglish
        type: inject
        data:
          greeting: "Hello from JSON Workflow, "
        transition: GreetPerson
      - name: GreetInSpanish
        type: inject
        data:
          greeting: "Saludos desde JSON Workflow, "
        transition: GreetPerson
      - name: GreetPerson
        type: operation
        actions:
          - name: greetAction
            functionRef:
              refName: greetFunction
              arguments:
                message:  ".greeting+.name"
        end: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save a file in your local file system with this contents named <code>greetings-workflow.yaml</code> then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl apply -f greetings-workflow.yaml -n workflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can check the logs of the build of your Workflow via:</p>
</div>
<div class="listingblock">
<div class="title">Get the Workflow pod logs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># on Kubernetes
kubectl logs kogito-greeting-builder -n workflows

# on OpenShift
oc logs buildconfig/greeting -n workflows</code></pre>
</div>
</div>
<div class="paragraph">
<p>The final pushed image must be printed into the logs at the end of the build.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_check_if_the_workflow_is_running"><a class="anchor" href="#_check_if_the_workflow_is_running"></a>Check if the Workflow is running</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to check that the OpenShift Serverless Logic Greeting is up and running, you can try to perform a test HTTP call, from the greeting Pod.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Expose the workflow so you can access it:</p>
<div class="listingblock">
<div class="title">Exposing the greeting workflow on Minikube</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># On Minikube you can use Nodeport
kubectl patch svc greeting -n workflows -p '{"spec": {"type": "NodePort"}}'
GREETING_SVC=$(minikube service greeting -n workflows --url)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Exposing the greeting workflow on OpenShift</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># On OpenShift you can expose a route: https://docs.openshift.com/container-platform/4.13/networking/routes/route-configuration.html#nw-creating-a-route_route-configuration
oc expose svc greeting -n workflows
# get the public URL
GREETING_SVC=$(oc get route/greeting --template='{{.spec.host}}')</code></pre>
</div>
</div>
</li>
<li>
<p>Make the HTTP call using <code>curl</code>:</p>
<div class="listingblock">
<div class="title">Check if the greeting workflow is running</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST -H 'Content-Type:application/json' -H 'Accept:application/json' -d '{"name": "John", "language": "English"}' $GREETING_SVC/greeting</code></pre>
</div>
</div>
<div class="paragraph">
<p>If everything is working, you should receive a response like this:</p>
</div>
<div class="listingblock">
<div class="title">Response from the greeting workflow</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{"id":"b5fbfaa3-b125-4e6c-9311-fe5a3577efdd","workflowdata":{"name":"John","language":"English","greeting":"Hello from JSON Workflow, "}}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_restarting_a_build"><a class="anchor" href="#_restarting_a_build"></a>Restarting a build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you require to restart the build for some reason, you can add or edit the annotation <code>sonataflow.org/restartBuild: true</code> in the <code>SonataFlowBuild</code> instance.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Example of a SonataFlowBuild marked to restart</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">apiVersion: sonataflow.org/v1alpha08
kind: SonataFlowBuild
metadata:
  name: greeting
  annotations:
    sonataflow.org/restartBuild: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>After editing the resource, the operator will start a new build of the workflow. Once this is finished, the workflow will be notified and updated accordingly.</p>
</div>
<div class="paragraph">
<p>If the build fails, but the workflow has a working deployment, the operator won&#8217;t rollout a new deployment.</p>
</div>
<div class="paragraph">
<p>Ideally you should use this feature if there&#8217;s a problem with your workflow or the initial build revision.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_additional_resources"><a class="anchor" href="#_additional_resources"></a>Additional resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="known-issues.html" class="xref page">Serverless Logic Operator Known Issues, Limitations and Roadmap</a></p>
</li>
<li>
<p><a href="developing-workflows.html" class="xref page">Developing Workflows with the Operator</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_found_an_issue"><a class="anchor" href="#_found_an_issue"></a><em><strong>Found an issue?</strong></em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you find an issue or any misleading information, please feel free to report it <a href="https://github.com/apache/incubator-kie-kogito-docs/issues/new">here</a>.
We really appreciate it!</p>
</div>
</div>
</div>
</article>
        </main>
            </div>
  </div>
</div><footer class="footer">
  <p>Adapted from Antora default UI, (c) 2019</p>
</footer>
<script src="../../../../../_/js/site.js"></script>
<script src="../../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../../_/js/tabsBehavior.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
